#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸš€ Running pre-push checks..."

# Run tests to ensure code quality
echo "ğŸ§ª Running tests..."
if ! python -m pytest tests/ -v; then
    echo "âŒ Tests failed. Please fix before pushing."
    exit 1
fi

# Run coverage check
echo "ğŸ“Š Checking test coverage..."
if ! python -m pytest --cov=contentstack_management --cov-report=term-missing tests/; then
    echo "âŒ Coverage check failed. Please improve test coverage."
    exit 1
fi

# Run security scan on dependencies
if [ -n "$SNYK_TOKEN" ]; then
    echo "ğŸ” Running comprehensive Snyk scan..."
    if ! snyk test --severity-threshold=high; then
        echo "âŒ High severity vulnerabilities found. Please fix before pushing."
        exit 1
    fi
fi

echo "âœ… All pre-push checks passed!"
